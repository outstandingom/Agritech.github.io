<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plant Growth Stage Identifier</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
            color: #2e7d32;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: #1b5e20;
        }
        
        .description {
            font-size: 1.1rem;
            margin-bottom: 2rem;
            color: #388e3c;
            line-height: 1.6;
        }
        
        .upload-container {
            border: 3px dashed #81c784;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            background-color: #f1f8e9;
            cursor: pointer;
        }
        
        .upload-container:hover {
            border-color: #4caf50;
            background-color: #e8f5e9;
        }
        
        .upload-container.dragover {
            border-color: #2e7d32;
            background-color: #c8e6c9;
        }
        
        .upload-icon {
            font-size: 4rem;
            color: #66bb6a;
            margin-bottom: 1rem;
        }
        
        .upload-text {
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }
        
        .browse-btn {
            background-color: #4caf50;
            color: white;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 50px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .browse-btn:hover {
            background-color: #388e3c;
        }
        
        #file-input {
            display: none;
        }
        
        .image-preview {
            margin: 2rem 0;
            display: none;
        }
        
        .preview-img {
            max-width: 100%;
            max-height: 400px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .identify-btn {
            background-color: #ff9800;
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-bottom: 2rem;
            display: none;
        }
        
        .identify-btn:hover {
            background-color: #f57c00;
        }
        
        .identify-btn:disabled {
            background-color: #bdbdbd;
            cursor: not-allowed;
        }
        
        .result-container {
            display: none;
            margin-top: 2rem;
            padding: 1.5rem;
            border-radius: 15px;
            background-color: #e8f5e9;
            text-align: left;
        }
        
        .result-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #1b5e20;
        }
        
        .result-content {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #2e7d32;
        }
        
        .loading {
            display: none;
            margin: 2rem 0;
        }
        
        .spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4caf50;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 1rem;
            border-radius: 10px;
            margin-top: 1rem;
            display: none;
        }
        
        .stage-indicator {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
            position: relative;
        }
        
        .stage {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #e0e0e0;
            color: #757575;
            font-weight: bold;
            position: relative;
            z-index: 2;
        }
        
        .stage.active {
            background-color: #4caf50;
            color: white;
        }
        
        .stage-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 4px;
            background-color: #e0e0e0;
            transform: translateY(-50%);
            z-index: 1;
        }
        
        .stage-label {
            position: absolute;
            top: 70px;
            font-size: 0.8rem;
            text-align: center;
            width: 100px;
            left: -20px;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 1rem;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .upload-container {
                padding: 1.5rem;
            }
            
            .stage-label {
                font-size: 0.7rem;
                width: 80px;
                left: -10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üå± Plant Growth Stage Identifier</h1>
        <p class="description">Upload an image of your plant and our AI will identify its current growth stage and provide care recommendations.</p>
        
        <div class="upload-container" id="upload-area">
            <div class="upload-icon">üìÅ</div>
            <p class="upload-text">Drag & drop your plant image here</p>
            <p class="upload-text">or</p>
            <button class="browse-btn">Browse Files</button>
            <input type="file" id="file-input" accept="image/*">
        </div>
        
        <div class="image-preview" id="image-preview">
            <img class="preview-img" id="preview-img" src="" alt="Plant Image Preview">
        </div>
        
        <button class="identify-btn" id="identify-btn" disabled>Identify Plant Stage</button>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Analyzing your plant image...</p>
        </div>
        
        <div class="error-message" id="error-message"></div>
        
        <div class="stage-indicator">
            <div class="stage-line"></div>
            <div class="stage" id="stage-seed">üå±</div>
            <div class="stage" id="stage-seedling">ü™¥</div>
            <div class="stage" id="stage-vegetative">üåø</div>
            <div class="stage" id="stage-flowering">üå∏</div>
            <div class="stage" id="stage-fruiting">üçÖ</div>
        </div>
        
        <div class="result-container" id="result-container">
            <h2 class="result-title">Plant Analysis Result</h2>
            <div class="result-content" id="result-content"></div>
        </div>
    </div>

    <script>
        // DOM elements
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const previewImg = document.getElementById('preview-img');
        const imagePreview = document.getElementById('image-preview');
        const identifyBtn = document.getElementById('identify-btn');
        const loading = document.getElementById('loading');
        const resultContainer = document.getElementById('result-container');
        const resultContent = document.getElementById('result-content');
        const errorMessage = document.getElementById('error-message');
        
        // Stage indicators
        const stageSeed = document.getElementById('stage-seed');
        const stageSeedling = document.getElementById('stage-seedling');
        const stageVegetative = document.getElementById('stage-vegetative');
        const stageFlowering = document.getElementById('stage-flowering');
        const stageFruiting = document.getElementById('stage-fruiting');
        
        // API configuration
        const API_KEY = 'AIzaSyD-qhnQlGDMd2BcoZo-hv5ld2fbDzP49sI';
        const API_URL = 'https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent';
        
        // Event listeners
        uploadArea.addEventListener('click', () => fileInput.click());
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFileSelection();
            }
        });
        
        fileInput.addEventListener('change', handleFileSelection);
        
        identifyBtn.addEventListener('click', identifyPlantStage);
        
        function handleFileSelection() {
            const file = fileInput.files[0];
            
            if (file) {
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showError('Please select a valid image file.');
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showError('Please select an image smaller than 5MB.');
                    return;
                }
                
                // Preview image
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImg.src = e.target.result;
                    imagePreview.style.display = 'block';
                    identifyBtn.disabled = false;
                    identifyBtn.style.display = 'block';
                    hideError();
                    resetStages();
                    resultContainer.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }
        
        async function identifyPlantStage() {
            const file = fileInput.files[0];
            
            if (!file) {
                showError('Please select an image first.');
                return;
            }
            
            // Show loading state
            loading.style.display = 'block';
            identifyBtn.disabled = true;
            hideError();
            resultContainer.style.display = 'none';
            
            try {
                // Convert image to base64
                const base64Image = await fileToBase64(file);
                
                // Prepare the request to Gemini API
                const requestBody = {
                    contents: [
                        {
                            parts: [
                                {
                                    text: "Analyze this plant image and identify its growth stage. Provide the following information in your response:\n\n1. Plant species (if identifiable)\n2. Current growth stage (seed, seedling, vegetative, flowering, or fruiting)\n3. Key characteristics that helped identify the stage\n4. Recommended care tips for this stage\n\nPlease format your response with clear headings for each section."
                                },
                                {
                                    inline_data: {
                                        mime_type: file.type,
                                        data: base64Image.split(',')[1] // Remove data URL prefix
                                    }
                                }
                            ]
                        }
                    ]
                };
                
                // Make API request
                const response = await fetch(`${API_URL}?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                if (!response.ok) {
                    throw new Error(`API request failed with status ${response.status}`);
                }
                
                const data = await response.json();
                
                // Extract the response text
                const responseText = data.candidates[0].content.parts[0].text;
                
                // Display the result
                displayResult(responseText);
                
                // Update stage indicator based on the response
                updateStageIndicator(responseText);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Failed to analyze the plant image. Please try again.');
            } finally {
                // Hide loading state
                loading.style.display = 'none';
                identifyBtn.disabled = false;
            }
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
        
        function displayResult(resultText) {
            resultContent.innerHTML = formatResultText(resultText);
            resultContainer.style.display = 'block';
            
            // Scroll to result
            resultContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function formatResultText(text) {
            // Simple formatting - you could enhance this with more sophisticated parsing
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold text
                .replace(/\n/g, '<br>') // Line breaks
                .replace(/(\d+\.)\s/g, '<br><strong>$1</strong> '); // Numbered lists
        }
        
        function updateStageIndicator(responseText) {
            // Reset all stages
            resetStages();
            
            // Determine the stage based on keywords in the response
            const lowerText = responseText.toLowerCase();
            
            if (lowerText.includes('seed')) {
                stageSeed.classList.add('active');
            }
            if (lowerText.includes('seedling')) {
                stageSeedling.classList.add('active');
            }
            if (lowerText.includes('vegetative') || lowerText.includes('growth') || lowerText.includes('leaf')) {
                stageVegetative.classList.add('active');
            }
            if (lowerText.includes('flower') || lowerText.includes('bloom')) {
                stageFlowering.classList.add('active');
            }
            if (lowerText.includes('fruit') || lowerText.includes('produce')) {
                stageFruiting.classList.add('active');
            }
        }
        
        function resetStages() {
            stageSeed.classList.remove('active');
            stageSeedling.classList.remove('active');
            stageVegetative.classList.remove('active');
            stageFlowering.classList.remove('active');
            stageFruiting.classList.remove('active');
        }
        
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }
        
        function hideError() {
            errorMessage.style.display = 'none';
        }
    </script>
</body>
</html>
